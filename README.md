# PriceMyMeds Backend API

RESTful API backend for the PriceMyMeds medication price comparison platform.

## Features

- üîí JWT-based authentication for admin users
- üíæ MongoDB database with Mongoose ODM
- üìä RESTful API endpoints for medications, pharmacies, and prices
- üîç Advanced search and filtering capabilities
- üìù Audit logging for all admin actions
- ‚ö° Optimized queries with compound indexes
- üõ°Ô∏è Rate limiting and security middleware

## Tech Stack

- **Node.js** with Express
- **MongoDB** with Mongoose
- **JWT** for authentication
- **Bcrypt** for password hashing
- **Express Validator** for input validation
- **Express Rate Limit** for API protection

## Prerequisites

- Node.js (v14 or higher)
- MongoDB (local or MongoDB Atlas)
- npm or yarn

## Installation

1. Clone the repository:
```bash
git clone https://github.com/yourusername/pricemymeds-backend.git
cd pricemymeds-backend
```

2. Install dependencies:
```bash
npm install
```

3. Create a `.env` file:
```env
MONGO_URI=mongodb://localhost:27017/pricemymeds
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
PORT=5001
NODE_ENV=development
```

4. Start the development server:
```bash
npm run dev
```

The API will be available at `http://localhost:5001`

## Available Scripts

- `npm run dev` - Run with nodemon for development
- `npm start` - Run in production mode
- `npm run migrate` - Run data migration scripts
- `npm run seed` - Seed database with sample data

## API Endpoints

### Public Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/categories` | Get all categories |
| GET | `/api/medications` | Get all medications |
| GET | `/api/medications/:id` | Get specific medication |
| GET | `/api/pharmacies` | Get all pharmacies |
| GET | `/api/prices/medication/:id` | Get prices for medication |
| GET | `/api/prices/lowest/:id` | Get lowest price for medication |

### Admin Endpoints (Requires Authentication)

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/admin/auth/login` | Admin login |
| POST | `/api/admin/auth/change-password` | Change password |
| GET | `/api/admin/medications` | Get medications (paginated) |
| GET | `/api/admin/medications/:id` | Get medication with prices |
| POST | `/api/admin/medications` | Create medication |
| PUT | `/api/admin/medications/:id` | Update medication |
| DELETE | `/api/admin/medications/:id` | Delete medication |
| GET | `/api/admin/pharmacies` | Get all pharmacies |
| POST | `/api/admin/pharmacies` | Create pharmacy |
| PUT | `/api/admin/pharmacies/:id` | Update pharmacy |
| DELETE | `/api/admin/pharmacies/:id` | Delete pharmacy |
| POST | `/api/admin/prices/bulk` | Bulk update prices |
| PUT | `/api/admin/prices/:id` | Update single price |
| DELETE | `/api/admin/prices/:id` | Delete price |

## Database Schema

### Collections:
- **users** - Admin users
- **categories** - Medication categories and subcategories
- **medications** - Medication information
- **pharmacies** - Pharmacy details
- **prices** - Price data linking medications and pharmacies
- **auditlogs** - Admin action logs

## Security

- JWT tokens expire after 8 hours
- Passwords are hashed using bcrypt
- Rate limiting: 100 requests per 15 minutes (production)
- Input validation on all endpoints
- MongoDB injection protection

## Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| MONGO_URI | MongoDB connection string | Required |
| JWT_SECRET | Secret key for JWT | Required |
| PORT | Server port | 5001 |
| NODE_ENV | Environment (development/production) | development |

## Admin Setup

Create the default admin user:
```bash
node scripts/create-admin.js
```

Default credentials:
- Email: admin@pricemymeds.co.uk
- Password: Admin123!

**Important:** Change the password immediately after first login!

## Deployment

### Deploy to Render.com

1. **Fork/Push this repository to GitHub**

2. **Create a MongoDB Atlas database** (free tier available)
   - Sign up at https://www.mongodb.com/atlas
   - Create a new cluster
   - Get your connection string

3. **Deploy on Render**
   - Connect your GitHub account to Render
   - Create a new Web Service
   - Select this repository
   - Render will auto-detect the configuration from `render.yaml`

4. **Set Environment Variables in Render Dashboard**
   - `MONGO_URI`: Your MongoDB Atlas connection string
   - `JWT_SECRET`: Will be auto-generated by Render
   - `NODE_ENV`: production
   - `PORT`: 10000 (Render's default)

5. **Deploy**
   - Click "Deploy Web Service"
   - Your API will be available at `https://your-app.onrender.com`

### Manual Deployment (Other Platforms)

1. Set environment variables on your hosting platform
2. Ensure MongoDB is accessible
3. Run `npm install`
4. Start the server with `npm start`

### Recommended Hosting:
- **API**: Render, Railway, Heroku, or AWS EC2
- **Database**: MongoDB Atlas

## Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## License

This project is proprietary and confidential.

## Support

For support, email support@pricemymeds.co.uk